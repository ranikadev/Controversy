name: Test TwitterAPI.io Key

on:
  workflow_dispatch:  # Manual trigger via GitHub UI
    inputs:
      description: 'Trigger manual test'
    types:
      description: string

jobs:
  test-key:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Test API Key
        env:
          API_KEY: ${{ secrets.TWITTERAPI_IO_KEY }}  # Your secret key
        run: |
          if [[ -z "$API_KEY" ]]; then
            echo "❌ Error: TWITTERAPI_IO_KEY secret not found. Add it in repo settings > Secrets and variables > Actions."
            exit 1
          fi
          
          echo "Testing TwitterAPI.io key with Get Trends endpoint..."
          RESPONSE=$(curl -s -w "\n%{http_code}" -H "X-API-Key: $API_KEY" \
            https://api.twitterapi.io/twitter/trend)
          
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          BODY=$(echo "$RESPONSE" | sed '$d')
          
          if [ "$HTTP_CODE" -eq 200 ]; then
            echo "✅ Success! API key is valid."
            echo "Response body (truncated): $BODY" | head -c 200
            echo "... (full response available in logs)"
          else
            echo "❌ Failed with HTTP $HTTP_CODE"
            echo "Response body: $BODY"
            exit 1
          fi
        
